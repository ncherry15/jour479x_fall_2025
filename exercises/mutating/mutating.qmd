# Mutating data

One of the most common data analysis techniques is to look at change over time. The most common way of comparing change over time is through percent change. The math behind calculating percent change is very simple, and you should know it off the top of your head. The easy way to remember it is:

`(new - old) / old`

Or new minus old divided by old. Your new number minus the old number, the result of which is divided by the old number. To do that in R, we can use `dplyr` and `mutate` to calculate new metrics in a new field using existing fields of data.

So first we'll import the tidyverse so we can read in our data and begin to work with it. Go ahead and do that:

```{r}
#| warning: false
#| message: false
library(tidyverse)
```

Now you'll need a common and simple dataset of total attendance at NCAA football games over the last few seasons.

```{r}
#| warning: false
#| message: false
#| results: asis
#| echo: false
library(downloadthis)
library(glue)

dllink <- download_link(
  link = "https://dwillis.github.io/sports-data-files/attendance.csv",
  button_label = "Download csv file",
  button_type = "danger",
  has_icon = TRUE,
  icon = "fa fa-save",
  self_contained = FALSE
)

glue("<pre><p><strong>For this walkthrough:</strong></p><p>{dllink}</p></pre>")

```

You'll import it something like this.

```{r}
attendance <- read_csv('data/attendance.csv')
```

If you want to see the first six rows -- handy to take a peek at your data -- you can use the function `head`.

```{r}
head(attendance)
```

What's one thing you notice about the data that might make year-over-year comparisons more complex?

**Answer** The first thing that stood out to me were conference changes this complicates comparisons because different conferences influence attendance. For example, moving to a more competitive conference could either increase or decrease attendance. If your team is competitive i the new conference attendance is likely to increase. Another factor is teams not reporting their attendance accurately.

The code to calculate percent change is pretty simple. Remember, with `summarize`, we used `n()` to count things. With `mutate`, we use very similar syntax to calculate a new value using other values in our dataset. So in this case, we're trying to do (new-old)/old, but we're doing it with fields. If we look at what we got when we did `head`, you'll see there's \`2024\` as the new data, and we'll use \`2023\` as the old data. So we're looking at one year. Then, to help us, we'll use arrange again to sort it, so we get the fastest growing school over one year.

```{r}
attendance |> mutate(
  change = (`2024` - `2023`)/`2023`
) 
```
What do we see right away? Do those numbers look like we expect them to? No. They're a decimal expressed as a percentage. So let's fix that by multiplying by 100. 

```{r}
attendance |> mutate(
  change = ((`2024` - `2023`)/`2023`)*100
) 
```
Now, does this ordering do anything for us? No. Let's fix that with arrange. 

```{r}
attendance |> 
filter (Conference=="SEC")  |>
mutate(
  change = ((`2024` - `2023`)/`2023`)*100
) |> arrange(desc(change))
```

Who had the most growth in 2024 compared to the year before? What could account for that change? And what team(s) are the most interesting here?

**Answer** SMU experienced the most growth and I think it could be a result of their conference change. They moved into a more competitive conference so there was some new excitement surrounding the team. They faced more high-profile opponents which is likely to increase attendance. It was shocking to see UCONN's growth because they are not as good. I added a filter for the SEC conference and I was shocked to see the variability in change because the SEC has not changed much over the years. I expected the attendance to be more consistent across the board. I was also shocked to see Georgia's attendance down so much coming off of such a dominant National Championship and being the seceond best team in the conference.

## Back to women's soccer

Let's turn back to the women's soccer match data from this season.

Import it like this:

```{r}
matches_2025 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2025.csv")
```

Previously we calculated totals for shots attempted and shots on goal for each time. Now let's do shots on goal and goals, using group_by() and summarize(), and then we'll use mutate to add a percentage to that and see what stands out.

```{r}
matches_2025 |> 
  group_by(team) |> 
  summarise(
    total_on_goal = sum(so_g),
    total_goals = sum(goals)
  ) |> 
  mutate(percent = (total_goals/total_on_goal)*100) |> 
  arrange(desc(percent))
```

What stands out to you here? Describe that below. Would you narrow down the results to certain teams based on the data? If so, do that in the code and explain why you did it below. Finally, what's the most interesting result to you that could be a story?

**Answer** I noticed how close the percentage of goals were while the total goals varied so much. I was almost ready to say Seton Hall is really good offensively because they have the highest percentage but they also have taken a very minimal number of shots in comparison to the other higher percentages. I would narrow down the results to also see if goal percentages increase when teams are home. I would do so running this code:

```{r}
matches_2025 |> 
  group_by(team) |>
  filter(home_away=="Home") |>
  summarise(
    total_on_goal = sum(so_g),
    total_goals = sum(goals)
  ) |> 
  mutate(percent = (total_goals/total_on_goal)*100) |> 
  arrange(desc(percent))
```
  
I used majority of the same code ad added a filter for only home games. Based on this, I would say home games have a major influence on scoring opportunities.Teams seem to have a higher percentage when they are home. The most interesting result is how many shots are on goal, not only because shots on gal typically signify good shots but more so the number of shots on goal displays how much a team is shooting. I would argue the more shots you take, the more likely you are to win because you create more scoring opportunities. It is hard to take a "smart" shot in soccer. The data is showing me to take all shots and your likelihood of scoring will increase.